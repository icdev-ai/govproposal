{% extends "base.html" %}
{% block title %}Recompetes — {{ app_name }}{% endblock %}

{% block content %}
<h1>Recompete Intelligence</h1>

<!-- Stat grid -->
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1rem;margin-bottom:1.5rem">
    <div class="card" style="text-align:center;padding:1rem">
        <div style="font-size:2rem;font-weight:700;color:#2980b9">{{ total_count }}</div>
        <div style="font-size:.82rem;color:#7f8c8d">Total Tracked</div>
    </div>
    <div class="card" style="text-align:center;padding:1rem">
        <div style="font-size:2rem;font-weight:700;color:#e67e22">{{ upcoming_count }}</div>
        <div style="font-size:.82rem;color:#7f8c8d">Upcoming 90 Days</div>
    </div>
    <div class="card" style="text-align:center;padding:1rem">
        <div style="font-size:2rem;font-weight:700;color:{% if avg_displacement >= 0.7 %}#e74c3c{% elif avg_displacement >= 0.4 %}#f39c12{% else %}#27ae60{% endif %}">{{ '%.2f'|format(avg_displacement) }}</div>
        <div style="font-size:.82rem;color:#7f8c8d">Avg Displacement Difficulty</div>
    </div>
    <div class="card" style="text-align:center;padding:1rem">
        <div style="font-size:2rem;font-weight:700;color:#f39c12">{{ pending_count }}</div>
        <div style="font-size:.82rem;color:#7f8c8d">Decision Pending</div>
    </div>
</div>

<!-- Filter -->
<div style="margin-bottom:1rem;display:flex;gap:0.5rem;align-items:center">
    <label style="font-size:.85rem;font-weight:600;color:#555">Filter:</label>
    <a href="{{ url_for('recompetes') }}"
       style="padding:.25rem .7rem;border:1px solid #ddd;border-radius:4px;font-size:.82rem;text-decoration:none;color:{% if not status_filter %}#fff{% else %}#555{% endif %};background:{% if not status_filter %}#2980b9{% else %}#fff{% endif %}">All</a>
    <a href="{{ url_for('recompetes', status='monitoring') }}"
       style="padding:.25rem .7rem;border:1px solid #ddd;border-radius:4px;font-size:.82rem;text-decoration:none;color:{% if status_filter == 'monitoring' %}#fff{% else %}#555{% endif %};background:{% if status_filter == 'monitoring' %}#2980b9{% else %}#fff{% endif %}">Monitoring</a>
    <a href="{{ url_for('recompetes', status='pursuing') }}"
       style="padding:.25rem .7rem;border:1px solid #ddd;border-radius:4px;font-size:.82rem;text-decoration:none;color:{% if status_filter == 'pursuing' %}#fff{% else %}#555{% endif %};background:{% if status_filter == 'pursuing' %}#27ae60{% else %}#fff{% endif %}">Pursuing</a>
    <a href="{{ url_for('recompetes', status='won') }}"
       style="padding:.25rem .7rem;border:1px solid #ddd;border-radius:4px;font-size:.82rem;text-decoration:none;color:{% if status_filter == 'won' %}#fff{% else %}#555{% endif %};background:{% if status_filter == 'won' %}#27ae60{% else %}#fff{% endif %}">Won</a>
    <a href="{{ url_for('recompetes', status='lost') }}"
       style="padding:.25rem .7rem;border:1px solid #ddd;border-radius:4px;font-size:.82rem;text-decoration:none;color:{% if status_filter == 'lost' %}#fff{% else %}#555{% endif %};background:{% if status_filter == 'lost' %}#e74c3c{% else %}#fff{% endif %}">Lost</a>
</div>

<!-- Recompetes table -->
<section class="card">
    <div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Contract #</th>
                <th>Title</th>
                <th>Incumbent</th>
                <th>Agency</th>
                <th>Current Value</th>
                <th>Recompete Date</th>
                <th>Displacement Score</th>
                <th>Our Decision</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for r in recompetes %}
            <tr>
                <td><a href="{{ url_for('recompete_detail', recompete_id=r['id']) }}">{{ r['contract_number'] or '—' }}</a></td>
                <td>
                    <a href="{{ url_for('recompete_detail', recompete_id=r['id']) }}">
                        {{ r['title'][:60] }}{% if r['title']|length > 60 %}...{% endif %}
                    </a>
                </td>
                <td>{{ r['incumbent_name'] or '—' }}</td>
                <td>{{ r['agency'] or '—' }}</td>
                <td>{% if r['current_value'] %}${{ '{:,.0f}'.format(r['current_value']) }}{% else %}—{% endif %}</td>
                <td>{{ r['anticipated_recompete_date'][:10] if r['anticipated_recompete_date'] else '—' }}</td>
                <td>
                    {% if r['displacement_score'] is not none %}
                    <span style="padding:.2rem .6rem;border-radius:3px;font-size:.82rem;font-weight:600;
                        {% if r['displacement_score'] >= 0.7 %}background:#fde8e8;color:#c0392b
                        {% elif r['displacement_score'] >= 0.4 %}background:#fef9e7;color:#f39c12
                        {% else %}background:#e8f8f0;color:#27ae60{% endif %}">
                        {{ '%.2f'|format(r['displacement_score']) }}
                    </span>
                    {% else %}—{% endif %}
                </td>
                <td>
                    {% if r['our_decision'] == 'pursue' %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#e8f8f0;color:#27ae60">pursue</span>
                    {% elif r['our_decision'] == 'no_bid' %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#f0f0f0;color:#7f8c8d">no bid</span>
                    {% elif r['our_decision'] == 'undecided' %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#fef9e7;color:#f39c12">undecided</span>
                    {% else %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#f0f0f0;color:#7f8c8d">{{ (r['our_decision'] or '—')|replace('_',' ') }}</span>
                    {% endif %}
                </td>
                <td>
                    {% if r['status'] == 'monitoring' %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#eaf4fb;color:#2980b9">monitoring</span>
                    {% elif r['status'] == 'pursuing' %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#e8f8f0;color:#27ae60">pursuing</span>
                    {% elif r['status'] == 'proposal_submitted' %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#eaf4fb;color:#2980b9">proposal submitted</span>
                    {% elif r['status'] == 'won' %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#e8f8f0;color:#27ae60">won</span>
                    {% elif r['status'] == 'lost' %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#fde8e8;color:#e74c3c">lost</span>
                    {% elif r['status'] == 'cancelled' %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#f0f0f0;color:#7f8c8d">cancelled</span>
                    {% else %}
                    <span style="padding:.15rem .5rem;border-radius:3px;font-size:.78rem;font-weight:600;background:#f0f0f0;color:#7f8c8d">{{ (r['status'] or '—')|replace('_',' ') }}</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    {% if not recompetes %}
    <div class="empty-state" style="padding:2.5rem 1rem;text-align:center">
        <p style="margin-bottom:.5rem;color:#7f8c8d;font-size:.95rem">No recompetes tracked yet.</p>
    </div>
    {% endif %}
</section>
{% endblock %}
